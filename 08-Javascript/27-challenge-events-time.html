<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Challenge Events Time</title>
   <link rel="stylesheet" href="css/styles.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
   <style>

      section section{
         height: 500px;
         margin: 0px auto;
         padding: 0px;
         width: 800px;
      }

      .sinver{
         display: none;
      }

      section.inicio{
         background: transparent url(imgs/MarioGame/bg-stage1.png) no-repeat center;
         background-size: contain;
         position: relative;
      }

      section.inicio button.btnPlay{
        background: url(imgs/MarioGame/btn-play.png) no-repeat center;
            cursor: pointer;
            position: absolute;
            filter: drop-shadow(0px 4px 4px rgba(0, 0, 0, 0.25));
            border: none;
            height: 50px;
            left: 500px;
            position: absolute;
            top: 310px;
            transition: all 0.2s ease-in;
            width: 136px;
      }

      section.inicio button.btnPlay:hover{
         transform: scale(1.05);
      }

      @keyframes animParallaxTitulo{
         0% { background-position: 0px 100px; }
         100% { background-position: -500px 100px; }

      }


      section.seccionJuego{
         background: url(imgs/MarioGame/stage2.png) no-repeat center;
         background-size: cover;
         overflow: hidden;
         border-radius: 25px;
         position: relative;
      }


      section.seccionJuego div.zonaJuego{
         height: 362px;
         width: 800px;
      }

      section.seccionJuego div.punticos{
         *border: 1px solid blue;
         border-top: 10px solid #3583FF;
         height: 122px;
         width: 800px;
      }

      section.seccionJuego div.punticos div{
         height: 40px;
         padding: 0;
         width: 150px;
         position: absolute;
         top: 433px;
      }

      section.seccionJuego div.punticos div.puntaje{
         left: 180px;
      }

      section.seccionJuego div.punticos div.tiempo{
         left: 416px;
      }

      section.seccionJuego div.punticos div.energia{
         left: 656px;
      }

      section.seccionJuego div.punticos div h3{
         background: none;
         color: #05B3D9;
         font-family: Rubik Mono One;
         font-style: normal;
         font-weight: normal;
         font-size: 42px;
         line-height: 10px;
         margin: 0px auto;
         padding: 0;

      }

      section.seccionJuego div.zonaJuego div.mario{
         background: transparent url(imgs/MarioGame/mario.png) no-repeat center;
         background-size: contain;

         height: 120px;
         width: 160px;
         position: absolute;
         top: 120px;
         transition: all 0.1s linear;
         animation: 0.8s animationmario ease-in infinite;
      }
        
      @keyframes animationmario {
         0%, 100% { left: 0px; }
         50% { left: 2px; }
      }

      section.seccionJuego div.zonaJuego div.enemigos{
         background-size: contain;
         height: 120px;
         width: 160px;
         position: absolute;
         left: 640px;
      }

      section.seccionJuego div.zonaJuego div.parallax{
         background:transparent url(imgs/MarioGame/burbujas.jpg);
         height: 362px;
         width: 800px;
         animation: 5s animParallaxJuego linear infinite;
      }

      @keyframes animParallaxJuego {
         0%   { background-position: 0px 0px; }
         100% { background-position: -1000px 0px;    }
      }

      section.seccionJuego div.zonaJuego div.pez1{
         background: transparent url(imgs/MarioGame/pez1.png) no-repeat center;
      }

      section.seccionJuego div.zonaJuego div.pez2{
         background: transparent url(imgs/MarioGame/pez2.png) no-repeat center;
      }

      section.seccionJuego div.zonaJuego div.pulpo1{
         background: transparent url(imgs/MarioGame/pulpo1.png) no-repeat center;
      }

      section.seccionJuego div.zonaJuego div.pulpo2{
         background: transparent url(imgs/MarioGame/pulpo2.png) no-repeat center;
      }

   </style>
</head>
<body>
   <main>
      <header>
            <h1> <span> <a href="index.html">&larr;</a> </span> Challenge Events Time</h1>
      </header>
      <section>
         <!-- Seccion Titulo -->
         <section class="inicio animate__animated">
            <div class="instrucciones">
               <div class="parallax"></div>
            </div>
            <div class="fondoInstrucciones">
            </div>
            <button class="btnPlay"></button>
         </section> 

         <section class="seccionJuego sinver animate__animated">
            <div class="zonaJuego">
               <div class="mario"></div>
               <div class="enemigos"></div>
               <div class="parallax"></div>
               <div class="victoria sinver animate__animated"></div>
               <div class="derrota sinver animate__animated"></div>
            </div>
            <div class="punticos">
               <div class="puntaje"><h3 class="puntaje">0</h3></div>
               <div class="tiempo"><h3 class="tiempo">60</h3></div>
               <div class="energia"><h3 class="energia">100</h3></div>
            </div>
         </section>
         
      </section>
   </main>
   <audio src="audio/metroidDreadOSTThemeOfmarioAran.mp3" class="musicaTitulo"></audio>
   <audio src="audio/soundmario.mp3" class="musicaJuego"></audio>
   <audio src="audio/pierdevida.mp3" class="pierdevida"></audio>
   <audio src="audio/mario-bros game over.mp3" class="mgameover"></audio>
   <br>
   <script>
      const botonbtnPlay = document.querySelector('button.btnPlay');
      const inicio = document.querySelector('section.inicio');
      const seccionJuego = document.querySelector('section.seccionJuego');
      const mario = document.querySelector('div.mario');
      const enemigos = document.querySelector('div.enemigos');
      const posicionEnemigosTop = [0, 120, 240];
      const posicionEnemigosLeft = [640, 480, 320, 160, 0];
      const nombreEnemigos = ['pez1', 'pez2', 'pulpo2', 'pulpo1'];
      const musicaTitulo = document.querySelector('audio.musicaTitulo');
      const musicaJuego = document.querySelector('audio.musicaJuego');
      const mgameover = document.querySelector('audio.mgameover');
      const pierdevida = document.querySelector('audio.pierdevida')
      var puntaje = document.querySelector('h3.puntaje');
      var tiempo = document.querySelector('h3.tiempo');
      var energia = document.querySelector('h3.energia');
      mario.style.top = 120 + 'px';
      

      const juego = {
         
         puntos: 0,
         tiempoRestante: 60,
         energiaRestante: 100,
         posicionmario: 120,
         posicionLeftEnemigo: 640,
         
         correTiempo: function() {
            let intervalo = setInterval(function() {
               if (juego.tiempoRestante < 60 && juego.tiempoRestante > -1) {
                  if (juego.tiempoRestante % 10 == 0) {
                     juego.puntos += 100;
                  } else {
                     juego.puntos +=5;
                  }
               }
               if (juego.energiaRestante < 1) {
                  clearInterval(intervalo);
               }
               puntaje.innerText = juego.puntos;
               if (juego.tiempoRestante < 1) {
                  tiempo.innerText = '0';
                  pantallaVictoria.classList.toggle("sinver");
                  pantallaVictoria.classList.toggle("animate__fadeIn");
                  musicaJuego.pause();
                 
                  clearInterval(intervalo);
                  
               } else {
                  tiempo.innerText = juego.tiempoRestante--;
               }

            }, 1000);
         },
         aleatorioEnemigos: function() {
            let generacionEnemigos = setInterval(function(){
               //aleatorio entre 0 y <3 para la posicion de la lista de la posicion vertical del enemigo
               let randPos = Math.floor(Math.random() * posicionEnemigosTop.length);
               //aleatorio entre 0 y <4 para la posicion de la lista de nombres de enemigos
               let randNom = Math.floor(Math.random() * nombreEnemigos.length);
               enemigos.classList.remove(nombreEnemigos[0]);
               enemigos.classList.remove(nombreEnemigos[1]);
               enemigos.classList.remove(nombreEnemigos[2]);
               enemigos.classList.remove(nombreEnemigos[3]);
               enemigos.classList.add(nombreEnemigos[randNom]);
               enemigos.style.top = posicionEnemigosTop[randPos] + "px";
               juego.posicionLeftEnemigo = 500;
               //console.log(randPos + " - " + randNombre);
               if (juego.tiempoRestante < 0) {
                  clearInterval(generacionEnemigos);
               }
            }, 840);
            
            let movimientoEnemigos = setInterval(function(){
               enemigos.style.left = juego.posicionLeftEnemigo + "px";
               juego.posicionLeftEnemigo = juego.posicionLeftEnemigo-5;
               if (juego.tiempoRestante < 0) {
                  clearInterval(movimientoEnemigos);
               }
            }, 7);

            let compararColision = setInterval(function(){
               console.log(enemigos.offsetTop);
               if (juego.tiempoRestante<59 && mario.style.top == enemigos.style.top && (enemigos.style.left <= "160px") ){
                  console.log("Enemigos: " + enemigos.offsetLeft);
                  pierdevida.currentTime = 0;
                  pierdevida.play();
                  juego.energiaRestante--;
                  energia.innerText= juego.energiaRestante;
                  if(juego.energiaRestante<=0){
                     juego.energiaRestante=0;
                     energia.innerText= juego.energiaRestante;
                     pantallaDerrota.classList.toggle("sinver");
                     pantallaDerrota.classList.toggle("animate__fadeInDown");
                     pierdevida.pause();
                     mgameover.play();
                     clearInterval(compararColision);
                  }
                  if (juego.tiempoRestante < 1) {
                     clearInterval(compararColision);
                  }
               }
            }, 10);
         },
         btnPlayMusicaJuego: function(){
            musicaJuego.currentTime = 0;
            musicaJuego.play();
            musicaJuego.loop = true;
         },
         
         detenerMusicaTitulo: function(){
            musicaTitulo.pause();
         }, 
      }

      /* Eventos */
      botonbtnPlay.onclick = function(){
         inicio.classList.add('animate__backOutUp');
         seccionJuego.classList.add('animate__backInUp');
         setTimeout(function() {
            inicio.classList.toggle("sinver");
            seccionJuego.classList.toggle("sinver");
         },500);
         setTimeout(function() {
            juego.correTiempo();
            juego.aleatorioEnemigos();
            juego.btnPlayMusicaJuego();
            juego.detenerMusicaTitulo();
         },500);
      }

      musicaTitulo.play();
      musicaTitulo.currentTime = 7;
      musicaTitulo.loop = true;    
      
      document.onkeydown = function(event) {
      
         if(event.keyCode == 38) {
            if ( juego.posicionmario > 0) {
               juego.posicionmario -= 120;
               mario.style.top = juego.posicionmario + 'px';
            }
         }
         if(event.keyCode == 40) {
            if ( juego.posicionmario < 240) {
               juego.posicionmario += 120;
               mario.style.top = juego.posicionmario + 'px';
            }
         }
      }

   </script>
</body>
</html>